# 费曼笔记：并发 vs 并行

> **"理解了不够简单，说明理解得还不够深"**

---

## 最简单的解释

### 并发（Concurrency）= 一个人轮流做多件事

想象你一个人在厨房：
- 你开始切菜
- 切了一会儿，去看看汤煮好没
- 看完汤，回来继续切菜
- 切完菜，又去检查汤

**关键**：你在**交替**做两件事，看起来像同时在做，但实际上是轮流进行。

---

### 并行（Parallelism）= 多个人同时做多件事

想象你和朋友一起在厨房：
- 你负责切菜
- 朋友负责煮汤
- 你们**同时**在工作，互不干扰

**关键**：多件事**真正同时**在进行。

---

## 一句话总结

| 概念 | 一句话 | 关键词 |
|------|--------|--------|
| **并发** | 轮流做 | 交替、同一时间段 |
| **并行** | 同时做 | 同时、同一时刻 |

---

## 生活类比对照表

| 场景 | 并发还是并行？ | 为什么 |
|------|----------------|--------|
| 单核 CPU + 多任务 | 并发 | 只有一个 CPU，轮流处理 |
| 多核 CPU + 多任务 | 并行 | 每个 CPU 独立工作 |
| 一个人边吃饭边看手机 | 并发 | 一个人只能轮流做 |
| 两个人各自工作 | 并行 | 两个人同时做 |
| 单车道多辆车排队 | 并发 | 车辆交替通过 |
| 多车道多辆车并行 | 并行 | 车辆同时通行 |

---

## 为什么 Python 开发者要理解这个？

### Python 的特殊情况：GIL（全局解释器锁）

Python 有一个限制，叫 **GIL**（Global Interpreter Lock）：

**GIL 的规则**：同一时刻，只能有一个线程执行 Python 代码。

**这意味着**：
- ✅ Python 的多线程可以实现**并发**（轮流执行）
- ❌ Python 的多线程**无法实现并行**（无法同时执行）
- ✅ 要实现并行，必须用**多进程**（multiprocessing）

---

## 实际应用场景

### 什么时候用并发（多线程/异步）？

**IO 密集型任务**（等待时间长）：
- 网络请求（等待服务器响应）
- 文件读写（等待磁盘）
- 数据库查询（等待数据库）

**原因**：等待的时候可以让其他任务运行

**例子**：
```python
# 爬虫抓取 100 个网页
# 大部分时间在等待服务器响应
# 适合并发
```

---

### 什么时候用并行（多进程）？

**CPU 密集型任务**（计算量大）：
- 图片处理
- 数据分析
- 机器学习训练
- 视频编码

**原因**：需要多个 CPU 真正同时工作

**例子**：
```python
# 处理 1000 张图片的滤镜效果
# 需要 CPU 持续计算
# 适合并行
```

---

## FastAPI 的选择

**FastAPI 使用异步编程（async/await）**

**为什么？**
- Web 服务器主要处理 **IO 密集型任务**
- 大量时间花在等待：数据库、外部 API、文件读写
- 异步可以在等待时处理其他请求
- 一个 CPU 核心可以处理成百上千个并发请求

**类比**：
- 传统同步方式：一个服务员一次服务一桌客人（效率低）
- FastAPI 异步方式：一个服务员同时照看 10 桌客人，哪桌需要响应就处理哪桌（效率高）

---

## 验证理解（费曼测试）

### 测试 1：自我解释

如果让你用一个生活中的例子向不懂技术的朋友解释"并发"和"并行"，你会怎么说？

<details>
<summary>参考答案</summary>

**并发**：就像一个收银员同时排队服务多个顾客，哪个顾客准备好了就服务哪个，但实际上是轮流扫码。

**并行**：就像超市开了多个收银台，每个收银员独立服务一队顾客，真正同时在工作。
</details>

---

### 测试 2：场景判断

判断以下场景应该用并发还是并行：

1. 爬虫抓取 100 个网页
2. 批量处理 1000 张照片的滤镜效果
3. Web 服务器处理用户请求
4. 挖矿程序（加密货币计算）

<details>
<summary>查看答案</summary>

1. **并发** - IO 密集，等待网络响应
2. **并行** - CPU 密集，需要大量计算
3. **并发** - IO 密集，等待数据库/外部服务
4. **并行** - CPU 密集，持续计算
</details>

---

## 核心要点总结

1. **并发 = 轮流做**（看起来同时，实际交替）
2. **并行 = 同时做**（真正同时进行）
3. **Python 多线程 = 并发**（受 GIL 限制）
4. **Python 多进程 = 并行**（突破 GIL 限制）
5. **IO 密集 = 用并发**（多线程/异步）
6. **CPU 密集 = 用并行**（多进程）
7. **FastAPI 用异步**（处理大量 IO 并发请求）

---

**下一步**：理解"同步 vs 异步"编程模式
