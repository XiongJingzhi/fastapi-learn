"""
é˜¶æ®µ 0.2: äº‹ä»¶å¾ªç¯ - ç†è§£å¼‚æ­¥çš„"å¼•æ“"

å­¦ä¹ ç›®æ ‡ï¼š
1. ç†è§£äº‹ä»¶å¾ªç¯æ˜¯ä»€ä¹ˆ
2. çœ‹åˆ°ä»»åŠ¡å¦‚ä½•è¢«è°ƒåº¦å’Œæ‰§è¡Œ
3. ç†è§£ await çš„ä½œç”¨ï¼šè®©å‡ºæ§åˆ¶æƒï¼Œè®©äº‹ä»¶å¾ªç¯è°ƒåº¦å…¶ä»–ä»»åŠ¡

æ ¸å¿ƒæ¦‚å¿µï¼š
- äº‹ä»¶å¾ªç¯ï¼ˆEvent Loopï¼‰ï¼šå¼‚æ­¥ç¨‹åºçš„"è°ƒåº¦å™¨"ï¼Œè´Ÿè´£ç®¡ç†å’Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡
- åç¨‹ï¼ˆCoroutineï¼‰ï¼šç”¨ async å®šä¹‰çš„å‡½æ•°ï¼Œè°ƒç”¨åè¿”å›ä¸€ä¸ªåç¨‹å¯¹è±¡
- awaitï¼šæš‚åœå½“å‰åç¨‹ï¼Œè®©äº‹ä»¶å¾ªç¯å»æ‰§è¡Œå…¶ä»–ä»»åŠ¡
- asyncio.run()ï¼šåˆ›å»ºäº‹ä»¶å¾ªç¯å¹¶è¿è¡Œä¸»åç¨‹

è¿è¡Œè¿™ä¸ªç¤ºä¾‹ï¼Œè§‚å¯Ÿä»»åŠ¡çš„è°ƒåº¦é¡ºåºï¼
"""

import asyncio


async def simple_task(name: str, delay: float):
    """æ¼”ç¤ºä»»åŠ¡æ‰§è¡Œçš„ç»†èŠ‚"""
    print(f"  [{name}] å¼€å§‹æ‰§è¡Œ")
    print(f"  [{name}] å³å°† awaitï¼Œå³å°†è®©å‡ºæ§åˆ¶æƒ...")
    await asyncio.sleep(delay)
    print(f"  [{name}] await ç»“æŸï¼Œé‡æ–°è·å¾—æ§åˆ¶æƒï¼")
    return f"{name}çš„ç»“æœ"


async def demonstrate_task_scheduling():
    """æ¼”ç¤ºäº‹ä»¶å¾ªç¯å¦‚ä½•è°ƒåº¦ä»»åŠ¡"""
    print("\nğŸ“Œ åˆ›å»º3ä¸ªåç¨‹å¯¹è±¡ï¼ˆè¿˜æ²¡è¿è¡Œï¼‰")
    print("-" * 50)

    # åˆ›å»ºåç¨‹å¯¹è±¡ï¼ˆæ³¨æ„ï¼šè°ƒç”¨åç¨‹å‡½æ•°ä¸ä¼šç«‹å³æ‰§è¡Œï¼‰
    coro1 = simple_task("ä»»åŠ¡A", 0.1)
    coro2 = simple_task("ä»»åŠ¡B", 0.1)
    coro3 = simple_task("ä»»åŠ¡C", 0.1)

    print(f"âœ… åç¨‹å¯¹è±¡å·²åˆ›å»º: {coro1}")
    print(f"   ç±»å‹: {type(coro1)}")
    print(f"   è¿™æ˜¯ä¸€ä¸ªåç¨‹å¯¹è±¡ï¼Œè¿˜ä¸æ˜¯åœ¨è¿è¡Œçš„ä»»åŠ¡\n")

    print("ğŸ“Œ å°†åç¨‹åŒ…è£…æˆä»»åŠ¡å¹¶è°ƒåº¦")
    print("-" * 50)

    # åˆ›å»ºä»»åŠ¡ï¼ˆåŠ å…¥äº‹ä»¶å¾ªç¯çš„è°ƒåº¦é˜Ÿåˆ—ï¼‰
    task1 = asyncio.create_task(coro1)
    print(f"  âœ… ä»»åŠ¡1å·²åˆ›å»ºå¹¶åŠ å…¥è°ƒåº¦é˜Ÿåˆ—")

    task2 = asyncio.create_task(coro2)
    print(f"  âœ… ä»»åŠ¡2å·²åˆ›å»ºå¹¶åŠ å…¥è°ƒåº¦é˜Ÿåˆ—")

    task3 = asyncio.create_task(coro3)
    print(f"  âœ… ä»»åŠ¡3å·²åˆ›å»ºå¹¶åŠ å…¥è°ƒåº¦é˜Ÿåˆ—\n")

    print("ğŸ“Œ ç°åœ¨äº‹ä»¶å¾ªç¯ä¼šè°ƒåº¦è¿™äº›ä»»åŠ¡")
    print("-" * 50)

    # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    results = await asyncio.gather(task1, task2, task3)

    print("\nğŸ“Œ æ‰€æœ‰ä»»åŠ¡å®Œæˆ")
    print("-" * 50)
    print(f"ğŸ“¦ ç»“æœ: {results}")


async def demonstrate_await_behavior():
    """æ¼”ç¤º await çš„è¡Œä¸ºï¼šè®©å‡ºæ§åˆ¶æƒ"""
    print("\nğŸ“Œ æ¼”ç¤º await å¦‚ä½•è®©å‡ºæ§åˆ¶æƒ")
    print("-" * 50)

    async def task_with_multiple_awaits(name: str):
        print(f"  [{name}] ç¬¬1æ¬¡æ‰§è¡Œ")
        await asyncio.sleep(0.1)  # ç¬¬1æ¬¡è®©å‡º
        print(f"  [{name}] ç¬¬2æ¬¡æ‰§è¡Œï¼ˆä»ç¬¬1æ¬¡awaitæ¢å¤ï¼‰")
        await asyncio.sleep(0.1)  # ç¬¬2æ¬¡è®©å‡º
        print(f"  [{name}] ç¬¬3æ¬¡æ‰§è¡Œï¼ˆä»ç¬¬2æ¬¡awaitæ¢å¤ï¼‰")
        return f"{name}å®Œæˆ"

    # å¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œè§‚å¯Ÿå®ƒä»¬å¦‚ä½•äº¤æ›¿æ‰§è¡Œ
    results = await asyncio.gather(
        task_with_multiple_awaits("A"),
        task_with_multiple_awaits("B"),
    )

    print(f"\nğŸ“¦ ç»“æœ: {results}")


def main():
    """è¿è¡Œæ‰€æœ‰æ¼”ç¤º"""
    print("\n" + "="*50)
    print("ğŸ“ é˜¶æ®µ 0.2: äº‹ä»¶å¾ªç¯ - å¼‚æ­¥çš„'å¼•æ“'")
    print("="*50)

    # æ¼”ç¤º1ï¼šä»»åŠ¡è°ƒåº¦
    asyncio.run(demonstrate_task_scheduling())

    print("\n" + "â¬‡ï¸" * 25)

    # æ¼”ç¤º2ï¼šawaitè¡Œä¸º
    asyncio.run(demonstrate_await_behavior())

    print("\n" + "="*50)
    print("ğŸ’¡ æ ¸å¿ƒè¦ç‚¹ï¼š")
    print("1. äº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œè´Ÿè´£ç®¡ç†å’Œæ‰§è¡Œæ‰€æœ‰ä»»åŠ¡")
    print("2. è°ƒç”¨åç¨‹å‡½æ•°ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œéœ€è¦è¢«äº‹ä»¶å¾ªç¯è°ƒåº¦")
    print("3. await ä¼šæš‚åœå½“å‰åç¨‹ï¼Œè®©äº‹ä»¶å¾ªç¯å»æ‰§è¡Œå…¶ä»–ä»»åŠ¡")
    print("4. asyncio.gather() åŒæ—¶å¯åŠ¨å¤šä¸ªä»»åŠ¡ï¼Œå¹¶å‘æ‰§è¡Œ")
    print("="*50 + "\n")


if __name__ == "__main__":
    main()
