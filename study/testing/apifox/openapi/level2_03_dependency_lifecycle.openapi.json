{
  "openapi": "3.1.0",
  "info": {
    "title": "ä¾èµ–çš„ç”Ÿå‘½å‘¨æœŸ",
    "description": "æ¼”ç¤ºä¾èµ–çš„ä¸åŒç”Ÿå‘½å‘¨æœŸå’Œèµ„æºç®¡ç†",
    "version": "2.0.0"
  },
  "paths": {
    "/request/count": {
      "get": {
        "summary": "Request Count",
        "description": "Request-scoped ç¤ºä¾‹\n\nğŸ” è¡Œä¸ºï¼š\n- æ¯æ¬¡è¯·æ±‚éƒ½åˆ›å»ºæ–°çš„ RequestCounter\n- counter.call_count æ€»æ˜¯ä» 0 å¼€å§‹\n- ä¸åŒè¯·æ±‚çš„ counter æ˜¯ä¸åŒçš„å¯¹è±¡",
        "operationId": "request_count_request_count_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/app/stats": {
      "get": {
        "summary": "App Stats",
        "description": "Application-scoped ç¤ºä¾‹\n\nğŸ” è¡Œä¸ºï¼š\n- æ‰€æœ‰è¯·æ±‚å…±äº«åŒä¸€ä¸ª AppState\n- state.request_count ä¼šç´¯åŠ \n- state.last_request_time ä¼šæ›´æ–°\n\nâœ… å¯ä»¥ç”¨æ¥åšï¼š\n- è¯·æ±‚è®¡æ•°\n- å…¨å±€ç»Ÿè®¡\n- é…ç½®ç®¡ç†",
        "operationId": "app_stats_app_stats_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/db/query": {
      "get": {
        "summary": "Query Database",
        "description": "ä½¿ç”¨ yield ç®¡ç†çš„æ•°æ®åº“è¿æ¥\n\nğŸ” æ‰§è¡Œæµç¨‹ï¼š\n1. get_db_connection() è¢«è°ƒç”¨\n2. åˆ›å»º DatabaseConnectionï¼ˆæ‰“å°\"è¿æ¥\"ï¼‰\n3. db å¯¹è±¡æ³¨å…¥åˆ°è¿™é‡Œ\n4. æ‰§è¡ŒæŸ¥è¯¢é€»è¾‘\n5. è¿”å›å“åº”\n6. æ‰§è¡Œ db.close()ï¼ˆæ‰“å°\"å…³é—­\"ï¼‰\n\nâœ… æ— è®ºæ˜¯å¦å‡ºé”™ï¼Œè¿æ¥éƒ½ä¼šè¢«æ­£ç¡®å…³é—­ï¼",
        "operationId": "query_database_db_query_get",
        "parameters": [
          {
            "name": "db_name",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "default": "test_db",
              "title": "Db Name"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/HTTPValidationError"
                }
              }
            }
          }
        }
      }
    },
    "/tx/success": {
      "get": {
        "summary": "Successful Transaction",
        "description": "æˆåŠŸçš„äº‹åŠ¡\n\nğŸ” æ‰§è¡Œæµç¨‹ï¼š\n1. åˆ›å»ºäº‹åŠ¡ï¼ˆæ‰“å°\"äº‹åŠ¡å¼€å§‹\"ï¼‰\n2. æ‰§è¡Œä¸šåŠ¡é€»è¾‘\n3. è¿”å›å“åº”\n4. æ‰§è¡Œ tx.commit()ï¼ˆæ‰“å°\"äº‹åŠ¡æäº¤\"ï¼‰",
        "operationId": "successful_transaction_tx_success_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/tx/fail": {
      "get": {
        "summary": "Failed Transaction",
        "description": "å¤±è´¥çš„äº‹åŠ¡\n\nğŸ” æ‰§è¡Œæµç¨‹ï¼š\n1. åˆ›å»ºäº‹åŠ¡ï¼ˆæ‰“å°\"äº‹åŠ¡å¼€å§‹\"ï¼‰\n2. æŠ›å‡ºå¼‚å¸¸\n3. æ‰§è¡Œ tx.rollback()ï¼ˆæ‰“å°\"äº‹åŠ¡å›æ»š\"ï¼‰\n4. å¼‚å¸¸ç»§ç»­ä¼ æ’­",
        "operationId": "failed_transaction_tx_fail_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/cache/demo": {
      "get": {
        "summary": "Demo Cache",
        "description": "ä¾èµ–ç¼“å­˜æ¼”ç¤º\n\nğŸ” è§‚å¯Ÿï¼š\n- æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º\n- \"åˆ›å»ºæ˜‚è´µèµ„æº\" åªæ‰“å°ä¸€æ¬¡\n- resource1, resource2, resource3 æ˜¯åŒä¸€ä¸ªå¯¹è±¡\n\nâœ… æ€§èƒ½ä¼˜åŒ–ï¼š\n- é¿å…é‡å¤åˆ›å»º\n- èŠ‚çœèµ„æº\n- æé«˜æ€§èƒ½",
        "operationId": "demo_cache_cache_demo_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/cache/disabled": {
      "get": {
        "summary": "Demo No Cache",
        "description": "ç¦ç”¨ç¼“å­˜æ¼”ç¤º\n\nğŸ” è¡Œä¸ºï¼š\n- æ¯æ¬¡ä½¿ç”¨éƒ½åˆ›å»ºæ–°å®ä¾‹\n- resource1 å’Œ resource2 æ˜¯ä¸åŒçš„å¯¹è±¡\n\nğŸ’¡ ä½¿ç”¨åœºæ™¯ï¼š\n- éœ€è¦æ¯æ¬¡éƒ½è·å–æ–°æ•°æ®\n- ä¸å¸Œæœ›ç¼“å­˜\n- ç‰¹æ®Šéœ€æ±‚",
        "operationId": "demo_no_cache_cache_disabled_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/lifecycle/compare": {
      "get": {
        "summary": "Compare Lifecycles",
        "description": "ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”æ€»ç»“\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nRequest-scopedï¼ˆé»˜è®¤ï¼‰\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\ndef get_data() -> Data:\n    return Data()  # æ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹\n\n@app.get(\"/data\")\nasync def use_data(\n    data: Data = Depends(get_data)\n):\n    return data\n\nç‰¹ç‚¹ï¼š\n- æ¯ä¸ªè¯·æ±‚åˆ›å»ºæ–°å®ä¾‹\n- è¯·æ±‚ç»“æŸé”€æ¯å®ä¾‹\n- ä¸åŒè¯·æ±‚ä¸å…±äº«çŠ¶æ€\n- FastAPI é»˜è®¤è¡Œä¸º\n\né€‚ç”¨åœºæ™¯ï¼š\nâœ… å¤§å¤šæ•°ä¸šåŠ¡é€»è¾‘\nâœ… è¯·æ±‚ç‰¹å®šæ•°æ®\nâœ… éœ€è¦çŠ¶æ€éš”ç¦»\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nApplication-scopedï¼ˆå…¨å±€å•ä¾‹ï¼‰\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\napp_state = AppState()  # æ¨¡å—çº§å˜é‡\n\ndef get_state() -> AppState:\n    return app_state  # å§‹ç»ˆè¿”å›åŒä¸€ä¸ªå®ä¾‹\n\n@app.get(\"/state\")\nasync def use_state(\n    state: AppState = Depends(get_state)\n):\n    return state\n\nç‰¹ç‚¹ï¼š\n- åº”ç”¨å¯åŠ¨æ—¶åˆ›å»º\n- æ‰€æœ‰è¯·æ±‚å…±äº«å®ä¾‹\n- çŠ¶æ€æŒä¹…åŒ–\n- éœ€è¦è€ƒè™‘å¹¶å‘å®‰å…¨\n\né€‚ç”¨åœºæ™¯ï¼š\nâœ… é…ç½®ä¿¡æ¯ï¼ˆåªè¯»ï¼‰\nâœ… å…¨å±€ç»Ÿè®¡ï¼ˆéœ€åŠ é”ï¼‰\nâœ… è¿æ¥æ± \nâœ… ç¼“å­˜ï¼ˆéœ€åŠ é”ï¼‰\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nä½¿ç”¨ yield ç®¡ç†èµ„æº\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\ndef get_db():\n    db = Database()\n    try:\n        yield db  # æ³¨å…¥åˆ° endpoint\n    finally:\n        db.close()  # æ¸…ç†èµ„æº\n\n@app.get(\"/query\")\nasync def query(\n    db: Database = Depends(get_db)\n):\n    return db.query(\"...\")\n\nç‰¹ç‚¹ï¼š\n- è‡ªåŠ¨ç®¡ç†èµ„æº\n- ç¡®ä¿æ¸…ç†ä»£ç æ‰§è¡Œ\n- å³ä½¿å¼‚å¸¸ä¹Ÿä¼šæ¸…ç†\n- ç±»ä¼¼ Python çš„ with è¯­å¥\n\né€‚ç”¨åœºæ™¯ï¼š\nâœ… æ•°æ®åº“è¿æ¥\nâœ… æ–‡ä»¶å¥æŸ„\nâœ… ç½‘ç»œè¿æ¥\nâœ… ä»»ä½•éœ€è¦æ¸…ç†çš„èµ„æº\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•",
        "operationId": "compare_lifecycles_lifecycle_compare_get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    },
    "/": {
      "get": {
        "summary": "Root",
        "operationId": "root__get",
        "responses": {
          "200": {
            "description": "Successful Response",
            "content": {
              "application/json": {
                "schema": {}
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "HTTPValidationError": {
        "properties": {
          "detail": {
            "items": {
              "$ref": "#/components/schemas/ValidationError"
            },
            "type": "array",
            "title": "Detail"
          }
        },
        "type": "object",
        "title": "HTTPValidationError"
      },
      "ValidationError": {
        "properties": {
          "loc": {
            "items": {
              "anyOf": [
                {
                  "type": "string"
                },
                {
                  "type": "integer"
                }
              ]
            },
            "type": "array",
            "title": "Location"
          },
          "msg": {
            "type": "string",
            "title": "Message"
          },
          "type": {
            "type": "string",
            "title": "Error Type"
          },
          "input": {
            "title": "Input"
          },
          "ctx": {
            "type": "object",
            "title": "Context"
          }
        },
        "type": "object",
        "required": [
          "loc",
          "msg",
          "type"
        ],
        "title": "ValidationError"
      }
    }
  }
}