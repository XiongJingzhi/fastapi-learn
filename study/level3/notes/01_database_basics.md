# 01. æ•°æ®åº“åŸºç¡€ - Database Basics

## ğŸ“ åœ¨æ¶æ„ä¸­çš„ä½ç½®

**ä» Mock Repository åˆ°çœŸå®æ•°æ®åº“**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Level 2: ä½¿ç”¨ Mock Repositoryï¼ˆå†…å­˜å­˜å‚¨ï¼‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

class InMemoryUserRepository(UserRepository):
    def __init__(self):
        self.users = {}  # âŒ æ•°æ®å­˜åœ¨å†…å­˜ä¸­

    async def save(self, user: User) -> User:
        self.users[user.id] = user
        return user

é—®é¢˜ï¼š
- åº”ç”¨é‡å¯ï¼Œæ•°æ®ä¸¢å¤±
- æ— æ³•å¤„ç†å¹¶å‘
- æ²¡æœ‰äº‹åŠ¡
- æ— æ³•æ”¯æŒå¤§æ•°æ®é‡

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Level 3: ä½¿ç”¨çœŸå®æ•°æ®åº“ï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

class SQLUserRepository(UserRepository):
    def __init__(self, session: AsyncSession):
        self.session = session  # âœ… è¿æ¥åˆ° PostgreSQL

    async def save(self, user: User) -> User:
        self.session.add(user)
        await self.session.commit()  # âœ… äº‹åŠ¡æäº¤
        await self.session.refresh(user)
        return user

å¥½å¤„ï¼š
- æ•°æ®æŒä¹…åŒ–
- æ”¯æŒå¹¶å‘
- äº‹åŠ¡ç®¡ç†
- æ”¯æŒå¤æ‚æŸ¥è¯¢
```

**ğŸ¯ ä½ çš„å­¦ä¹ ç›®æ ‡**ï¼šç†è§£å…³ç³»å‹æ•°æ®åº“çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸ºå­¦ä¹  SQLAlchemy æ‰“ä¸‹åŸºç¡€ã€‚

---

## ğŸ¯ ä»€ä¹ˆæ˜¯æ•°æ®åº“ï¼Ÿ

### ç”Ÿæ´»ç±»æ¯”ï¼šæ–‡ä»¶æŸœç³»ç»Ÿ

**æƒ³è±¡ä¸€ä¸ªåŠå…¬å®¤çš„æ–‡ä»¶æŸœ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ–‡ä»¶æŸœï¼ˆDatabaseï¼‰          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ æŠ½å±‰1 â”‚  â”‚ æŠ½å±‰2 â”‚  â”‚ æŠ½å±‰3 â”‚     â”‚
â”‚  â”‚ å‘˜å·¥  â”‚  â”‚ è®¢å•  â”‚  â”‚ äº§å“  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚     Table     Table     Table      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¯ä¸ªæŠ½å±‰ï¼ˆè¡¨ï¼‰é‡Œæœ‰å¾ˆå¤šæ–‡ä»¶ï¼ˆè¡Œï¼‰
æ¯ä¸ªæ–‡ä»¶æœ‰ä¸åŒçš„ä¿¡æ¯ï¼ˆåˆ—ï¼‰
```

**æ•°æ®åº“å°±æ˜¯ç”µå­åŒ–çš„æ–‡ä»¶æŸœ**ï¼š
- **Database**ï¼šæ•´ä¸ªæ–‡ä»¶æŸœ
- **Table**ï¼šä¸€ä¸ªæŠ½å±‰
- **Row**ï¼šä¸€ä¸ªæ–‡ä»¶
- **Column**ï¼šæ–‡ä»¶ä¸Šçš„ä¸€ä¸ªä¿¡æ¯é¡¹

---

## ğŸ—ï¸ å…³ç³»å‹æ•°æ®åº“åŸºç¡€

### æ ¸å¿ƒæ¦‚å¿µ

#### 1. è¡¨ (Table)

**è¡¨**ï¼šå­˜å‚¨ç›¸å…³æ•°æ®çš„ç»“æ„ã€‚

**ç±»æ¯”**ï¼šExcel è¡¨æ ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           users è¡¨                  â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id â”‚ username   â”‚ email            â”‚ â† åˆ— (Column)
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ alice      â”‚ alice@ex.com     â”‚ â† è¡Œ (Row)
â”‚ 2  â”‚ bob        â”‚ bob@ex.com       â”‚
â”‚ 3  â”‚ charlie    â”‚ charlie@ex.com   â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**SQL åˆ›å»ºè¡¨**ï¼š

```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

#### 2. ä¸»é”® (Primary Key)

**ä¸»é”®**ï¼šå”¯ä¸€æ ‡è¯†è¡¨ä¸­æ¯ä¸€è¡Œçš„åˆ—ã€‚

**ç±»æ¯”**ï¼šèº«ä»½è¯å· - æ¯ä¸ªäººéƒ½æœ‰å”¯ä¸€çš„èº«ä»½è¯å·ã€‚

```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ username   â”‚ email            â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ alice      â”‚ alice@ex.com     â”‚ â† id=1 æ˜¯ä¸»é”®
â”‚ 2  â”‚ bob        â”‚ bob@ex.com       â”‚ â† id=2 æ˜¯ä¸»é”®
â”‚ 3  â”‚ charlie    â”‚ charlie@ex.com   â”‚ â† id=3 æ˜¯ä¸»é”®
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘
   ä¸»é”®ï¼šå”¯ä¸€æ ‡è¯†
   ä¸èƒ½é‡å¤ï¼Œä¸èƒ½ä¸ºç©º
```

**ä¸ºä»€ä¹ˆéœ€è¦ä¸»é”®ï¼Ÿ**

```python
# âŒ æ²¡æœ‰ä¸»é”®çš„é—®é¢˜
UPDATE users SET username = 'alice2'
WHERE username = 'alice'

# é—®é¢˜ï¼šå¦‚æœæœ‰ä¸¤ä¸ª aliceï¼Ÿä¼šæ›´æ–°å¤šæ¡ï¼

# âœ… ä½¿ç”¨ä¸»é”®
UPDATE users SET username = 'alice2'
WHERE id = 1

# å¥½å¤„ï¼šç²¾ç¡®æ›´æ–°ä¸€æ¡è®°å½•
```

---

#### 3. å¤–é”® (Foreign Key)

**å¤–é”®**ï¼šå»ºç«‹è¡¨ä¸è¡¨ä¹‹é—´çš„å…³è”ã€‚

**ç±»æ¯”**ï¼šè®¢å•ä¸Šçš„"å®¢æˆ·ID" - å…³è”åˆ°å®¢æˆ·è¡¨ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    users è¡¨     â”‚         â”‚   orders è¡¨     â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id â”‚ username   â”‚         â”‚ id â”‚ user_id  â”‚ product     â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ alice      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ 1  â”‚ 1        â”‚ Laptop      â”‚
â”‚ 2  â”‚ bob        â”‚         â”‚ 2  â”‚ 1        â”‚ Mouse       â”‚
â”‚ 3  â”‚ charlie    â”‚         â”‚ 3  â”‚ 2        â”‚ Keyboard    â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘                            â†‘
       ä¸»é”®                        å¤–é”® (æŒ‡å‘ users.id)
```

**SQL åˆ›å»ºå¤–é”®**ï¼š

```sql
CREATE TABLE orders (
    id INTEGER PRIMARY KEY,
    user_id INTEGER,
    product_name VARCHAR(100),
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- å¥½å¤„ï¼š
-- 1. æ•°æ®å®Œæ•´æ€§ï¼šä¸èƒ½æ’å…¥ä¸å­˜åœ¨çš„ user_id
-- 2. çº§è”åˆ é™¤ï¼šåˆ é™¤ç”¨æˆ·æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤å…¶è®¢å•
-- 3. çº§è”æ›´æ–°ï¼šæ›´æ–°ç”¨æˆ· ID æ—¶ï¼Œè‡ªåŠ¨æ›´æ–°è®¢å•
```

---

#### 4. ç´¢å¼• (Index)

**ç´¢å¼•**ï¼šåŠ é€ŸæŸ¥è¯¢çš„æ•°æ®ç»“æ„ã€‚

**ç±»æ¯”**ï¼šä¹¦åçš„ç´¢å¼• - å¿«é€Ÿæ‰¾åˆ°æŸä¸€é¡µã€‚

```
æ²¡æœ‰ç´¢å¼•ï¼š
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚ username   â”‚ email            â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ alice      â”‚ alice@ex.com     â”‚
â”‚ 2  â”‚ bob        â”‚ bob@ex.com       â”‚
â”‚ ...â”‚ ...        â”‚ ...              â”‚
â”‚1000â”‚ zoe        â”‚ zoe@ex.com       â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æŸ¥è¯¢ï¼šWHERE email = 'bob@ex.com'
â†’ å¿…é¡»æ‰«ææ‰€æœ‰ 1000 è¡Œï¼ï¼ˆæ…¢ï¼‰

æœ‰ç´¢å¼•ï¼ˆåœ¨ email ä¸Šï¼‰ï¼š
email_index â†’ {alice@ex.com: 1, bob@ex.com: 2, ...}
â†’ ç›´æ¥å®šä½åˆ°ç¬¬ 2 è¡Œï¼ï¼ˆå¿«ï¼‰
```

**SQL åˆ›å»ºç´¢å¼•**ï¼š

```sql
-- åœ¨ email åˆ—ä¸Šåˆ›å»ºç´¢å¼•
CREATE INDEX idx_users_email ON users(email);

-- å¥½å¤„ï¼š
-- æŸ¥è¯¢é€Ÿåº¦å¿« 100-1000 å€
-- ä½†ï¼šæ’å…¥/æ›´æ–°ç¨æ…¢ï¼ˆéœ€è¦æ›´æ–°ç´¢å¼•ï¼‰
```

---

## ğŸ“Š SQL åŸºç¡€æŸ¥è¯¢

### CRUD æ“ä½œ

#### 1. Createï¼ˆåˆ›å»ºï¼‰

```sql
-- æ’å…¥ä¸€æ¡è®°å½•
INSERT INTO users (username, email)
VALUES ('alice', 'alice@example.com');

-- æ’å…¥å¤šæ¡è®°å½•
INSERT INTO users (username, email) VALUES
    ('bob', 'bob@example.com'),
    ('charlie', 'charlie@example.com');
```

---

#### 2. Readï¼ˆè¯»å–ï¼‰

```sql
-- æŸ¥è¯¢æ‰€æœ‰åˆ—
SELECT * FROM users;

-- æŸ¥è¯¢ç‰¹å®šåˆ—
SELECT username, email FROM users;

-- æ¡ä»¶æŸ¥è¯¢
SELECT * FROM users WHERE id = 1;

-- å¤šæ¡ä»¶æŸ¥è¯¢
SELECT * FROM users
WHERE email LIKE '%@example.com'
  AND created_at > '2024-01-01';

-- æ’åº
SELECT * FROM users ORDER BY created_at DESC;

-- é™åˆ¶ç»“æœæ•°é‡
SELECT * FROM users LIMIT 10 OFFSET 20;  -- ç¬¬ 21-30 æ¡
```

---

#### 3. Updateï¼ˆæ›´æ–°ï¼‰

```sql
-- æ›´æ–°å•æ¡è®°å½•
UPDATE users
SET username = 'alice_updated'
WHERE id = 1;

-- æ›´æ–°å¤šä¸ªå­—æ®µ
UPDATE users
SET username = 'alice2', email = 'alice2@example.com'
WHERE id = 1;

-- æ›´æ–°å¤šæ¡è®°å½•
UPDATE users
SET is_active = true
WHERE created_at > '2024-01-01';
```

---

#### 4. Deleteï¼ˆåˆ é™¤ï¼‰

```sql
-- åˆ é™¤å•æ¡è®°å½•
DELETE FROM users WHERE id = 1;

-- åˆ é™¤å¤šæ¡è®°å½•
DELETE FROM users WHERE created_at < '2023-01-01';

-- âš ï¸ å±é™©ï¼šåˆ é™¤æ‰€æœ‰è®°å½•
DELETE FROM users;  -- ä¸å¸¦ WHERE æ¡ä»¶ï¼
```

---

## ğŸ”— è¡¨å…³ç³»

### 1. ä¸€å¯¹ä¸€ (One-to-One)

**åœºæ™¯**ï¼šç”¨æˆ·å’Œç”¨æˆ·èµ„æ–™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         1:1         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ user_profilesâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚                     â”‚ id (PK)     â”‚
â”‚ username    â”‚                     â”‚ user_id (FK)â”‚
â”‚ email       â”‚                     â”‚ bio         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ avatar      â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸€ä¸ªç”¨æˆ· â†’ ä¸€ä¸ªèµ„æ–™å¡
```

**SQL å®ç°**ï¼š

```sql
CREATE TABLE user_profiles (
    id INTEGER PRIMARY KEY,
    user_id INTEGER UNIQUE,  -- UNIQUE ä¿è¯ä¸€å¯¹ä¸€
    bio TEXT,
    avatar VARCHAR(255),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

---

### 2. ä¸€å¯¹å¤š (One-to-Many)

**åœºæ™¯**ï¼šç”¨æˆ·å’Œè®¢å•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         1:N         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   orders    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚                     â”‚ id (PK)     â”‚
â”‚ username    â”‚                     â”‚ user_id (FK)â”‚
â”‚ email       â”‚                     â”‚ product     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ total       â”‚
                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸€ä¸ªç”¨æˆ· â†’ å¤šä¸ªè®¢å•
```

**SQL å®ç°**ï¼š

```sql
CREATE TABLE orders (
    id INTEGER PRIMARY KEY,
    user_id INTEGER,  -- ä¸éœ€è¦ UNIQUE
    product VARCHAR(100),
    total DECIMAL(10, 2),
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

---

### 3. å¤šå¯¹å¤š (Many-to-Many)

**åœºæ™¯**ï¼šå­¦ç”Ÿå’Œè¯¾ç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         N:M         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ students â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  courses â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)  â”‚                     â”‚ id (PK)  â”‚
â”‚ name     â”‚                     â”‚ title    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â–²                               â–²
     â”‚                               â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚enrollments  â”‚  â† ä¸­é—´è¡¨
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ student_id   â”‚ (FK â†’ students)
        â”‚ course_id    â”‚ (FK â†’ courses)
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¸€ä¸ªå­¦ç”Ÿ â†’ å¤šé—¨è¯¾ç¨‹
ä¸€é—¨è¯¾ç¨‹ â†’ å¤šä¸ªå­¦ç”Ÿ
```

**SQL å®ç°**ï¼š

```sql
-- ä¸­é—´è¡¨ï¼ˆå…³è”è¡¨ï¼‰
CREATE TABLE enrollments (
    student_id INTEGER,
    course_id INTEGER,
    enrolled_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (student_id, course_id),  -- è”åˆä¸»é”®
    FOREIGN KEY (student_id) REFERENCES students(id),
    FOREIGN KEY (course_id) REFERENCES courses(id)
);
```

---

## ğŸ¨ æ•°æ®å»ºæ¨¡

### è®¾è®¡ä¸€ä¸ªåšå®¢ç³»ç»Ÿ

**éœ€æ±‚**ï¼š
- ç”¨æˆ· (Users)
- æ–‡ç«  (Posts)
- è¯„è®º (Comments)
- æ ‡ç­¾ (Tags)

**æ•°æ®åº“è®¾è®¡**ï¼š

```sql
-- 1. ç”¨æˆ·è¡¨
CREATE TABLE users (
    id INTEGER PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 2. æ–‡ç« è¡¨
CREATE TABLE posts (
    id INTEGER PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    author_id INTEGER,  -- å¤–é”® â†’ users
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (author_id) REFERENCES users(id)
);

-- 3. è¯„è®ºè¡¨
CREATE TABLE comments (
    id INTEGER PRIMARY KEY,
    content TEXT NOT NULL,
    post_id INTEGER,  -- å¤–é”® â†’ posts
    author_id INTEGER,  -- å¤–é”® â†’ users
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (post_id) REFERENCES posts(id),
    FOREIGN KEY (author_id) REFERENCES users(id)
);

-- 4. æ ‡ç­¾è¡¨
CREATE TABLE tags (
    id INTEGER PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE
);

-- 5. æ–‡ç« -æ ‡ç­¾å…³è”è¡¨ï¼ˆå¤šå¯¹å¤šï¼‰
CREATE TABLE post_tags (
    post_id INTEGER,
    tag_id INTEGER,
    PRIMARY KEY (post_id, tag_id),
    FOREIGN KEY (post_id) REFERENCES posts(id),
    FOREIGN KEY (tag_id) REFERENCES tags(id)
);

-- 6. åˆ›å»ºç´¢å¼•
CREATE INDEX idx_posts_author ON posts(author_id);
CREATE INDEX idx_comments_post ON comments(post_id);
CREATE INDEX idx_comments_author ON comments(author_id);
```

**æ•°æ®å…³ç³»å›¾**ï¼š

```
users â”€â”€1:Nâ”€â”€ posts
 â”‚              â”‚
 â”‚              â””â”€â”€1:Nâ”€â”€ comments
 â”‚
 â””â”€â”€1:Nâ”€â”€ comments

posts â”€â”€N:Mâ”€â”€ tags
```

---

## ğŸ¯ å°å®éªŒï¼šè‡ªå·±åŠ¨æ‰‹

### å®éªŒ 1ï¼šåˆ›å»ºè¡¨

```sql
-- åˆ›å»ºä¸€ä¸ªç®€å•çš„ todo è¡¨
CREATE TABLE todos (
    id INTEGER PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    description TEXT,
    completed BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

### å®éªŒ 2ï¼šæ’å…¥æ•°æ®

```sql
-- æ’å…¥å‡ æ¡ todo
INSERT INTO todos (title, description) VALUES
    ('Learn FastAPI', 'Complete Level 1'),
    ('Build a project', 'Create a real application'),
    ('Write tests', 'Add unit tests');

-- æŸ¥è¯¢æ•°æ®
SELECT * FROM todos;
```

---

### å®éªŒ 3ï¼šæŸ¥è¯¢æ•°æ®

```sql
-- æŸ¥è¯¢æ‰€æœ‰æœªå®Œæˆçš„ todos
SELECT * FROM todos WHERE completed = FALSE;

-- æŸ¥è¯¢æ ‡é¢˜åŒ…å« "FastAPI" çš„ todos
SELECT * FROM todos WHERE title LIKE '%FastAPI%';

-- æŒ‰åˆ›å»ºæ—¶é—´æ’åº
SELECT * FROM todos ORDER BY created_at DESC;
```

---

### å®éªŒ 4ï¼šæ›´æ–°å’Œåˆ é™¤

```sql
-- æ ‡è®°ç¬¬ä¸€ä¸ª todo ä¸ºå®Œæˆ
UPDATE todos SET completed = TRUE WHERE id = 1;

-- åˆ é™¤å·²å®Œæˆçš„ todos
DELETE FROM todos WHERE completed = TRUE;
```

---

## ğŸ“š æ£€æŸ¥ç†è§£

å›ç­”è¿™äº›é—®é¢˜æ¥æµ‹è¯•ä½ çš„ç†è§£ï¼š

1. **ä»€ä¹ˆæ˜¯ä¸»é”®ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ä¸»é”®ï¼Ÿ**
   - æç¤ºï¼šå”¯ä¸€æ ‡è¯†æ¯ä¸€è¡Œ

2. **ä»€ä¹ˆæ˜¯å¤–é”®ï¼Ÿå®ƒæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ**
   - æç¤ºï¼šå»ºç«‹è¡¨ä¹‹é—´çš„å…³è”

3. **ç´¢å¼•ä¸ºä»€ä¹ˆèƒ½åŠ é€ŸæŸ¥è¯¢ï¼Ÿ**
   - æç¤ºï¼šä¹¦åçš„ç´¢å¼•ç±»æ¯”

4. **ä¸€å¯¹ä¸€ã€ä¸€å¯¹å¤šã€å¤šå¯¹å¤šçš„åŒºåˆ«ï¼Ÿ**
   - æç¤ºï¼šå…³ç³»çš„æ•°é‡

5. **CRUD åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ**
   - æç¤ºï¼šCreate, Read, Update, Delete

---

## ğŸš€ ä¸‹ä¸€æ­¥

ç°åœ¨ä½ å·²ç»ç†è§£äº†æ•°æ®åº“çš„åŸºæœ¬æ¦‚å¿µï¼Œæ¥ä¸‹æ¥ï¼š

1. **å­¦ä¹  SQLAlchemy**ï¼š`notes/02_sqlalchemy_basics.md`
2. **æŸ¥çœ‹å®é™…ä»£ç **ï¼š`examples/01_database_basics.py`

**è®°ä½**ï¼šæ•°æ®åº“åŸºç¡€æ˜¯å­¦ä¹  SQLAlchemy çš„å‰æï¼ç†è§£è¡¨ã€ä¸»é”®ã€å¤–é”®ã€å…³ç³»è¿™äº›æ¦‚å¿µï¼Œä¼šè®©åé¢çš„å­¦ä¹ æ›´è½»æ¾ã€‚

---

**è´¹æ›¼æŠ€å·§æ€»ç»“**ï¼š
- âœ… æ–‡ä»¶æŸœç±»æ¯”
- âœ… å¯è§†åŒ–è¡¨æ ¼
- âœ… è¯¦ç»†çš„ SQL ç¤ºä¾‹
- âœ… å…³ç³»ç±»å‹å¯¹æ¯”
- âœ… å®Œæ•´çš„åšå®¢ç³»ç»Ÿè®¾è®¡
